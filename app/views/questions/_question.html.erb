<%# app/views/questions/_question.html.erb %>
<div id="<%= dom_id(question) %>" class="question-answer-container">
  <div class="question-section">
    <div class="question-header">
      <h3>質問</h3>
      <% if user_signed_in? && current_user == question.user %>
        <span class="user-badge">あなたの質問</span>
      <% end %>
    </div>
    <div class="content-area">
      <%= Rinku.auto_link(simple_format(h(question.content)), :all, 'target="_blank" rel="noopener noreferrer"').html_safe %>
    </div>
  </div>

  <div class="answer-section">
    <h3>AIの回答 (Gemini)</h3>
    <div class="content-area">
      <% if question.answer_text.present? %>
        <%= Rinku.auto_link(simple_format(h(question.answer_text)), :all, 'target="_blank" rel="noopener noreferrer"').html_safe %>
      <% else %>
        <p>まだ回答がありません。</p>
      <% end %>
    </div>
  </div>

  <% if question.quiz_question.present? %>
    <div class="quiz-section">
      <h3>クイズ</h3>
      <div class="content-area">
        <%= h(question.quiz_question) %>
      </div>

      <h4>選択肢</h4>
      <div class="quiz-choices">
        <%= h(question.quiz_choices) %>
      </div>

      <h4 class="correct-answer">正解</h4>
      <div class="content-area">
        <%= h(question.quiz_answer) %>
      </div>
    </div>
  <% end %>

  <%# AIの出力があるときだけ保存ボタンを表示 %>
  <% if question.quiz_question.present? && question.answer_text.present? %>
    <div class="save-section">
      <%= button_to "このクイズと回答を保存する", save_quiz_and_answer_question_path(question), method: :post, class: "save-button" %>
   </div>
  <% end %>

  <div class="question-meta">
    <div class="meta-info">
      <span class="post-date">投稿日時：<%= l(question.created_at, format: :long) %></span>
      <% if user_signed_in? && current_user == question.user %>
        <span class="action-links">
          <%= link_to edit_question_path(question), class: 'button-small' do %>
            <i class="fas fa-edit"></i>
            <span>編集</span>
          <% end if defined?(edit_question_path) %>
          
          <%= link_to question_path(question),
              data: { turbo_method: :delete, turbo_confirm: '本当に削除しますか？' },
              class: 'button-small button-danger' do %>
            <i class="fas fa-trash-alt"></i>
            <span>削除</span>
          <% end if defined?(question_path) %>
        </span>
      <% end %>
    </div>
  </div>
  <hr>
</div>